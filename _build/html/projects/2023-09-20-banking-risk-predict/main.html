

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Credit Risk Prediction &#8212; João Pinheiro website</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'projects/2023-09-20-banking-risk-predict/main';</script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CV" href="../../cv.html" />
    <link rel="prev" title="Boosted Trees: XGBoost vs. CatBoost vs. LightGBM" href="../2023-10-01-catboost-lgbm-xgboost/main.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="João Pinheiro website - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="João Pinheiro website - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    João Pinheiro
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About me</a></li>

<li class="toctree-l1"><a class="reference internal" href="../projects.html">Projects</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../cv.html">CV</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Published</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/joaomh/joaomh.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/joaomh/joaomh.github.io/issues/new?title=Issue%20on%20page%20%2Fprojects/2023-09-20-banking-risk-predict/main.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/projects/2023-09-20-banking-risk-predict/main.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Credit Risk Prediction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Credit Risk Prediction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#training-some-models">Training some Models</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperparameter-optimization-using-optuna">Hyperparameter Optimization using Optuna</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#ranking-the-final-model">Ranking the final model</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="credit-risk-prediction">
<h1>Credit Risk Prediction<a class="headerlink" href="#credit-risk-prediction" title="Permalink to this heading">#</a></h1>
<p>This is a German credit risk dataset that can be found on Kaggle <a class="reference external" href="https://www.kaggle.com/datasets/kabure/german-credit-data-with-risk">German Risk</a>. My goal is to create a predictive model, use this model to generate a score for each client, and ultimately classify clients into risk profiles, differentiating between the riskiest and least risky</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h1>
<p>Context</p>
<p>Each person is classified as having good or bad credit risk according to the set of attributes. The selected attributes are:</p>
<ul class="simple">
<li><p>Age (numeric)</p></li>
<li><p>Sex (text: male, female)</p></li>
<li><p>Job (numeric: 0 - unskilled and non-resident, 1 - unskilled and resident, 2 - skilled, 3 - highly skilled)</p></li>
<li><p>Housing (text: own, rent, or free)</p></li>
<li><p>Saving accounts (text - little, moderate, quite rich, rich)</p></li>
<li><p>Checking account (text - little, moderate, rich)</p></li>
<li><p>Credit amount (numeric, in DM)</p></li>
<li><p>Duration (numeric, in month)</p></li>
<li><p>Purpose(text: car, furniture/equipment, radio/TV, domestic appliances, repairs, education, business, vacation/others)</p></li>
<li><p>Risk (Value target - Good or Bad Risk)</p></li>
</ul>
<p>The business team came to you because they want to understand the behavior and the profile of the most risk clients and our goal here is to create a predictive model to help them</p>
<p>My goal here is to create a prediction model. I’ll use Optuna for hyperparameter optimization then ‘rank’ the customer in scores and then use the shap to identify each variable as the most important</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="dataset">
<h1>Dataset<a class="headerlink" href="#dataset" title="Permalink to this heading">#</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">lightgbm</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">import</span> <span class="nn">optuna</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">plotly.offline</span> <span class="k">as</span> <span class="nn">py</span> 
<span class="n">py</span><span class="o">.</span><span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.tools</span> <span class="k">as</span> <span class="nn">tls</span> 
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># read the dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;german_credit_data.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>Age</th>
      <th>Sex</th>
      <th>Job</th>
      <th>Housing</th>
      <th>Saving accounts</th>
      <th>Checking account</th>
      <th>Credit amount</th>
      <th>Duration</th>
      <th>Purpose</th>
      <th>Risk</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>67</td>
      <td>male</td>
      <td>2</td>
      <td>own</td>
      <td>NaN</td>
      <td>little</td>
      <td>1169</td>
      <td>6</td>
      <td>radio/TV</td>
      <td>good</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>22</td>
      <td>female</td>
      <td>2</td>
      <td>own</td>
      <td>little</td>
      <td>moderate</td>
      <td>5951</td>
      <td>48</td>
      <td>radio/TV</td>
      <td>bad</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>49</td>
      <td>male</td>
      <td>1</td>
      <td>own</td>
      <td>little</td>
      <td>NaN</td>
      <td>2096</td>
      <td>12</td>
      <td>education</td>
      <td>good</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>45</td>
      <td>male</td>
      <td>2</td>
      <td>free</td>
      <td>little</td>
      <td>little</td>
      <td>7882</td>
      <td>42</td>
      <td>furniture/equipment</td>
      <td>good</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>53</td>
      <td>male</td>
      <td>2</td>
      <td>free</td>
      <td>little</td>
      <td>little</td>
      <td>4870</td>
      <td>24</td>
      <td>car</td>
      <td>bad</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>995</th>
      <td>995</td>
      <td>31</td>
      <td>female</td>
      <td>1</td>
      <td>own</td>
      <td>little</td>
      <td>NaN</td>
      <td>1736</td>
      <td>12</td>
      <td>furniture/equipment</td>
      <td>good</td>
    </tr>
    <tr>
      <th>996</th>
      <td>996</td>
      <td>40</td>
      <td>male</td>
      <td>3</td>
      <td>own</td>
      <td>little</td>
      <td>little</td>
      <td>3857</td>
      <td>30</td>
      <td>car</td>
      <td>good</td>
    </tr>
    <tr>
      <th>997</th>
      <td>997</td>
      <td>38</td>
      <td>male</td>
      <td>2</td>
      <td>own</td>
      <td>little</td>
      <td>NaN</td>
      <td>804</td>
      <td>12</td>
      <td>radio/TV</td>
      <td>good</td>
    </tr>
    <tr>
      <th>998</th>
      <td>998</td>
      <td>23</td>
      <td>male</td>
      <td>2</td>
      <td>free</td>
      <td>little</td>
      <td>little</td>
      <td>1845</td>
      <td>45</td>
      <td>radio/TV</td>
      <td>bad</td>
    </tr>
    <tr>
      <th>999</th>
      <td>999</td>
      <td>27</td>
      <td>male</td>
      <td>2</td>
      <td>own</td>
      <td>moderate</td>
      <td>moderate</td>
      <td>4576</td>
      <td>45</td>
      <td>car</td>
      <td>good</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 11 columns</p>
</div>
<ul class="simple">
<li><p>Looking at the Type of Data</p></li>
<li><p>Null Numbers or/and Unique values</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># knowing the shape of the data and search for missing</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1000 entries, 0 to 999
Data columns (total 11 columns):
 #   Column            Non-Null Count  Dtype 
---  ------            --------------  ----- 
 0   Unnamed: 0        1000 non-null   int64 
 1   Age               1000 non-null   int64 
 2   Sex               1000 non-null   object
 3   Job               1000 non-null   int64 
 4   Housing           1000 non-null   object
 5   Saving accounts   817 non-null    object
 6   Checking account  606 non-null    object
 7   Credit amount     1000 non-null   int64 
 8   Duration          1000 non-null   int64 
 9   Purpose           1000 non-null   object
 10  Risk              1000 non-null   object
dtypes: int64(5), object(6)
memory usage: 86.1+ KB
None
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># looking unique values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Unnamed: 0          1000
Age                   53
Sex                    2
Job                    4
Housing                3
Saving accounts        4
Checking account       3
Credit amount        921
Duration              33
Purpose                8
Risk                   2
dtype: int64
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="eda">
<h1>EDA<a class="headerlink" href="#eda" title="Permalink to this heading">#</a></h1>
<p>Let’s start looking through the target variable and their distribution, here I’ll show only some variables that I thought they have some interesting distribution, to see the others look the Notebook in the GitHub Repository</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_age</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_good</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;good&#39;</span><span class="p">][</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_bad</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bad&#39;</span><span class="p">][</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">hist_1</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_good</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Good Credit&quot;</span>
<span class="p">)</span>

<span class="n">hist_2</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_bad</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bad Credit&quot;</span>
<span class="p">)</span>

<span class="n">hist_3</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_age</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Overall Age&quot;</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">hist_1</span><span class="p">,</span> <span class="n">hist_2</span><span class="p">,</span> <span class="n">hist_3</span><span class="p">]</span>

<span class="n">layout</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Type of Credit by Age&quot;</span><span class="p">,</span> 
    <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;custom-sized-subplot-with-subplot-titles&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Age" src="projects/2023-09-20-banking-risk-predict/age.png" />
We can see that people with Bad Credit tend to more youth</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_housing</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Housing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_good</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;good&#39;</span><span class="p">][</span><span class="s1">&#39;Housing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_bad</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bad&#39;</span><span class="p">][</span><span class="s1">&#39;Housing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">hist_1</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_good</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Good Credit&quot;</span>
<span class="p">)</span>

<span class="n">hist_2</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_bad</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bad Credit&quot;</span>
<span class="p">)</span>

<span class="n">hist_3</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_housing</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Overall Housing&quot;</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">hist_1</span><span class="p">,</span> <span class="n">hist_2</span><span class="p">,</span> <span class="n">hist_3</span><span class="p">]</span>

<span class="n">layout</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Type of Credit by Housing&quot;</span><span class="p">,</span> 
    <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Housing&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;custom-sized-subplot-with-subplot-titles&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="House" src="projects/2023-09-20-banking-risk-predict/housing.png" />
People who own a house have better credit.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_saving</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Saving accounts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_good</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;good&#39;</span><span class="p">][</span><span class="s1">&#39;Saving accounts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_bad</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bad&#39;</span><span class="p">][</span><span class="s1">&#39;Saving accounts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">hist_1</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_good</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Good Credit&quot;</span>
<span class="p">)</span>

<span class="n">hist_2</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_bad</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bad Credit&quot;</span>
<span class="p">)</span>

<span class="n">hist_3</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_saving</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Overall saving&quot;</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">hist_1</span><span class="p">,</span> <span class="n">hist_2</span><span class="p">,</span> <span class="n">hist_3</span><span class="p">]</span>

<span class="n">layout</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Type of Credit by Saving&quot;</span><span class="p">,</span> 
    <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Saving&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;custom-sized-subplot-with-subplot-titles&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Saving" src="projects/2023-09-20-banking-risk-predict/saving.png" />
People with more savings accounts also have better credit</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_checking</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Checking account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_good</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;good&#39;</span><span class="p">][</span><span class="s1">&#39;Checking account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_bad</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bad&#39;</span><span class="p">][</span><span class="s1">&#39;Checking account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">hist_1</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_good</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Good Credit&quot;</span>
<span class="p">)</span>

<span class="n">hist_2</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_bad</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bad Credit&quot;</span>
<span class="p">)</span>

<span class="n">hist_3</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_checking</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Overall checking account&quot;</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">hist_1</span><span class="p">,</span> <span class="n">hist_2</span><span class="p">,</span> <span class="n">hist_3</span><span class="p">]</span>

<span class="n">layout</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Type of Credit by Checking Account&quot;</span><span class="p">,</span> 
    <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Checking Account&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;custom-sized-subplot-with-subplot-titles&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Checking" src="projects/2023-09-20-banking-risk-predict/checking.png" /></p>
<p>The same here, people with more checking account has better credit</p>
<div class="highlight-ptyhon notranslate"><div class="highlight"><pre><span></span>df_credit = df[&#39;Credit amount&#39;].values.tolist()
df_good = df.loc[df[&quot;Risk&quot;] == &#39;good&#39;][&#39;Credit amount&#39;].values.tolist()
df_bad = df.loc[df[&quot;Risk&quot;] == &#39;bad&#39;][&#39;Credit amount&#39;].values.tolist()

hist_1 = go.Histogram(
    x=df_good,
    histnorm=&#39;probability&#39;,
    name=&quot;Good Credit&quot;
)

hist_2 = go.Histogram(
    x=df_bad,
    histnorm=&#39;probability&#39;,
    name=&quot;Bad Credit&quot;
)

hist_3 = go.Histogram(
    x=df_credit,
    histnorm=&#39;probability&#39;,
    name=&quot;Overall Credit amount&quot;
)

data = [hist_1, hist_2, hist_3]

layout = dict(
    title=&quot;Type of Credit by Credit amount&quot;, 
    xaxis = dict(title=&quot;Credit amount&quot;)
)

fig = dict(data=data, layout=layout)

py.iplot(fig, filename=&#39;custom-sized-subplot-with-subplot-titles&#39;)
</pre></div>
</div>
<p><img alt="Credit" src="projects/2023-09-20-banking-risk-predict/credit_amount.png" />
People with more than 4k in credit amount have worse credit than people with less</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_purpose</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Purpose&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_good</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;good&#39;</span><span class="p">][</span><span class="s1">&#39;Purpose&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_bad</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bad&#39;</span><span class="p">][</span><span class="s1">&#39;Purpose&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">hist_1</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_good</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Good Credit&quot;</span>
<span class="p">)</span>

<span class="n">hist_2</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_bad</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bad Credit&quot;</span>
<span class="p">)</span>

<span class="n">hist_3</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_purpose</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Overall Purpose&quot;</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">hist_1</span><span class="p">,</span> <span class="n">hist_2</span><span class="p">,</span> <span class="n">hist_3</span><span class="p">]</span>

<span class="n">layout</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Type of Credit by Purpose&quot;</span><span class="p">,</span> 
    <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Purpose&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;custom-sized-subplot-with-subplot-titles&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Purpose" src="projects/2023-09-20-banking-risk-predict/purpose.png" />
People that the purpose is to buy radio/TV have a better credit</p>
<p>Now let’s see the distribution using two variables</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_good</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;good&#39;</span><span class="p">][</span><span class="s1">&#39;Checking account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_bad</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bad&#39;</span><span class="p">][</span><span class="s1">&#39;Checking account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">box_1</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_good</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Credit amount&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Good Credit&quot;</span>
<span class="p">)</span>

<span class="n">box_2</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_bad</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Credit amount&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bad Credit&quot;</span>
<span class="p">)</span>



<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">box_1</span><span class="p">,</span> <span class="n">box_2</span><span class="p">]</span>

<span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Credit Amount by Checking Account&#39;</span>
    <span class="p">),</span>
    <span class="n">boxmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span>
<span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;box-age-cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Credit" src="projects/2023-09-20-banking-risk-predict/amount_checking.png" />
The credit amount is also less in rich people (checking account), even in those bad credit</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">df_good</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;good&#39;</span><span class="p">][</span><span class="s1">&#39;Job&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_bad</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Risk&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bad&#39;</span><span class="p">][</span><span class="s1">&#39;Job&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">box_1</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_good</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Credit amount&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Good Credit&quot;</span>
<span class="p">)</span>

<span class="n">box_2</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df_bad</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Credit amount&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bad Credit&quot;</span>
<span class="p">)</span>



<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">box_1</span><span class="p">,</span> <span class="n">box_2</span><span class="p">]</span>

<span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Job&#39;</span>
    <span class="p">),</span>
    <span class="n">boxmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span>
<span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;box-age-cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Credit" src="projects/2023-09-20-banking-risk-predict/amount_job.png" />
Unskilled and non-residents with bad credit have more credit amount than others</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="preprocessing">
<h1>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this heading">#</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Unnamed: 0           int64
Age                  int64
Sex                 object
Job                  int64
Housing             object
Saving accounts     object
Checking account    object
Credit amount        int64
Duration             int64
Purpose             object
Risk                object
dtype: object
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Unnamed: 0            0
Age                   0
Sex                   0
Job                   0
Housing               0
Saving accounts     183
Checking account    394
Credit amount         0
Duration              0
Purpose               0
Risk                  0
dtype: int64
</pre></div>
</div>
<p>We will use one-hot encoding for the sex, housing, and purpose variables.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">one_hot</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Sex&quot;</span><span class="p">:</span> <span class="s2">&quot;sex&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Housing&quot;</span><span class="p">:</span> <span class="s2">&quot;hous&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Purpose&quot;</span><span class="p">:</span> <span class="s2">&quot;purp&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And ordinal encoding for the others</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ordinal_encoding</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Saving accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="kc">None</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;little&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;moderate&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;quite rich&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;rich&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;Checking account&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="kc">None</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;little&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;moderate&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;rich&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;Risk&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bad&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;good&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">one_hot_enconding</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col_prefix</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">col_prefix</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">encode_ordinal</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">custom_ordinals</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">map_dict</span> <span class="ow">in</span> <span class="n">custom_ordinals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">map_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_encode</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_encode</span> <span class="o">=</span> <span class="n">one_hot_enconding</span><span class="p">(</span><span class="n">df_encode</span><span class="p">,</span> <span class="n">one_hot</span><span class="p">)</span>
<span class="n">df_encode</span> <span class="o">=</span> <span class="n">encode_ordinal</span><span class="p">(</span><span class="n">df_encode</span><span class="p">,</span> <span class="n">ordinal_encoding</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_encode</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>Age</th>
      <th>Job</th>
      <th>Saving accounts</th>
      <th>Checking account</th>
      <th>Credit amount</th>
      <th>Duration</th>
      <th>Risk</th>
      <th>sex_female</th>
      <th>sex_male</th>
      <th>...</th>
      <th>hous_own</th>
      <th>hous_rent</th>
      <th>purp_business</th>
      <th>purp_car</th>
      <th>purp_domestic appliances</th>
      <th>purp_education</th>
      <th>purp_furniture/equipment</th>
      <th>purp_radio/TV</th>
      <th>purp_repairs</th>
      <th>purp_vacation/others</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>67</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>1169</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>22</td>
      <td>2</td>
      <td>1</td>
      <td>2</td>
      <td>5951</td>
      <td>48</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>49</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>2096</td>
      <td>12</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>45</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>7882</td>
      <td>42</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>53</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>4870</td>
      <td>24</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>995</th>
      <td>995</td>
      <td>31</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1736</td>
      <td>12</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>996</th>
      <td>996</td>
      <td>40</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>3857</td>
      <td>30</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>997</th>
      <td>997</td>
      <td>38</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>804</td>
      <td>12</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>998</th>
      <td>998</td>
      <td>23</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1845</td>
      <td>45</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>999</th>
      <td>999</td>
      <td>27</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>4576</td>
      <td>45</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 21 columns</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_encode</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Unnamed: 0                  int64
Age                         int64
Job                         int64
Saving accounts             int64
Checking account            int64
Credit amount               int64
Duration                    int64
Risk                        int64
sex_female                  uint8
sex_male                    uint8
hous_free                   uint8
hous_own                    uint8
hous_rent                   uint8
purp_business               uint8
purp_car                    uint8
purp_domestic appliances    uint8
purp_education              uint8
purp_furniture/equipment    uint8
purp_radio/TV               uint8
purp_repairs                uint8
purp_vacation/others        uint8
dtype: object
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_encode</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Unnamed: 0                  0
Age                         0
Job                         0
Saving accounts             0
Checking account            0
Credit amount               0
Duration                    0
Risk                        0
sex_female                  0
sex_male                    0
hous_free                   0
hous_own                    0
hous_rent                   0
purp_business               0
purp_car                    0
purp_domestic appliances    0
purp_education              0
purp_furniture/equipment    0
purp_radio/TV               0
purp_repairs                0
purp_vacation/others        0
dtype: int64
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check for duplicate rows</span>
<span class="n">df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_encode</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s1">&#39;Risk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>hous_own                   -0.134589
purp_radio/TV              -0.106922
Age                        -0.091127
sex_male                   -0.075493
Saving accounts            -0.033871
purp_domestic appliances    0.008016
purp_repairs                0.020828
purp_furniture/equipment    0.020971
purp_car                    0.022621
purp_vacation/others        0.028058
Job                         0.032735
Unnamed: 0                  0.034606
purp_business               0.036129
purp_education              0.049085
sex_female                  0.075493
hous_free                   0.081556
hous_rent                   0.092785
Credit amount               0.154739
Checking account            0.197788
Duration                    0.214927
Risk                        1.000000
Name: Risk, dtype: float64
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_encode</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Index([&#39;Unnamed: 0&#39;, &#39;Age&#39;, &#39;Job&#39;, &#39;Saving accounts&#39;, &#39;Checking account&#39;,
       &#39;Credit amount&#39;, &#39;Duration&#39;, &#39;Risk&#39;, &#39;sex_female&#39;, &#39;sex_male&#39;,
       &#39;hous_free&#39;, &#39;hous_own&#39;, &#39;hous_rent&#39;, &#39;purp_business&#39;, &#39;purp_car&#39;,
       &#39;purp_domestic appliances&#39;, &#39;purp_education&#39;,
       &#39;purp_furniture/equipment&#39;, &#39;purp_radio/TV&#39;, &#39;purp_repairs&#39;,
       &#39;purp_vacation/others&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<p>Getting all the coluns that we are going to use in our model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Job&#39;</span><span class="p">,</span> <span class="s1">&#39;Saving accounts&#39;</span><span class="p">,</span> <span class="s1">&#39;Checking account&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Credit amount&#39;</span><span class="p">,</span> <span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="s1">&#39;sex_female&#39;</span><span class="p">,</span> <span class="s1">&#39;sex_male&#39;</span><span class="p">,</span>
       <span class="s1">&#39;hous_free&#39;</span><span class="p">,</span> <span class="s1">&#39;hous_own&#39;</span><span class="p">,</span> <span class="s1">&#39;hous_rent&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_business&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_car&#39;</span><span class="p">,</span>
       <span class="s1">&#39;purp_domestic appliances&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_education&#39;</span><span class="p">,</span>
       <span class="s1">&#39;purp_furniture/equipment&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_radio/TV&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_repairs&#39;</span><span class="p">,</span>
       <span class="s1">&#39;purp_vacation/others&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_encode</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_encode</span><span class="p">[</span><span class="s1">&#39;Risk&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Unnamed: 0                   492.960000
Age                           36.224286
Job                            1.890000
Saving accounts                1.211429
Checking account               0.877143
Credit amount               2985.457143
Duration                      19.207143
Risk                           0.000000
sex_female                     0.287143
sex_male                       0.712857
hous_free                      0.091429
hous_own                       0.752857
hous_rent                      0.155714
purp_business                  0.090000
purp_car                       0.330000
purp_domestic appliances       0.011429
purp_education                 0.051429
purp_furniture/equipment       0.175714
purp_radio/TV                  0.311429
purp_repairs                   0.020000
purp_vacation/others           0.010000
dtype: float64
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_encode</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_encode</span><span class="p">[</span><span class="s1">&#39;Risk&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Unnamed: 0                   514.760000
Age                           33.963333
Job                            1.936667
Saving accounts                1.140000
Checking account               1.290000
Credit amount               3938.126667
Duration                      24.860000
Risk                           1.000000
sex_female                     0.363333
sex_male                       0.636667
hous_free                      0.146667
hous_own                       0.620000
hous_rent                      0.233333
purp_business                  0.113333
purp_car                       0.353333
purp_domestic appliances       0.013333
purp_education                 0.076667
purp_furniture/equipment       0.193333
purp_radio/TV                  0.206667
purp_repairs                   0.026667
purp_vacation/others           0.016667
dtype: float64
</pre></div>
</div>
<p>some correlation</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_encode</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Risk&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Risk&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Risk                        1.000000
Duration                    0.214927
Checking account            0.197788
Credit amount               0.154739
hous_own                    0.134589
purp_radio/TV               0.106922
hous_rent                   0.092785
Age                         0.091127
hous_free                   0.081556
sex_female                  0.075493
sex_male                    0.075493
purp_education              0.049085
purp_business               0.036129
Unnamed: 0                  0.034606
Saving accounts             0.033871
Job                         0.032735
purp_vacation/others        0.028058
purp_car                    0.022621
purp_furniture/equipment    0.020971
purp_repairs                0.020828
purp_domestic appliances    0.008016
Name: Risk, dtype: float64
</pre></div>
</div>
<p>Duration, checking account, credit amount, and owning house have the most Corr</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df_encode</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
            <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="png" src="projects/2023-09-20-banking-risk-predict/output_60_0.png" /></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="training-some-models">
<h1>Training some Models<a class="headerlink" href="#training-some-models" title="Permalink to this heading">#</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df_encode</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">model_cols</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_encode</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Risk&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span> 
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>((700, 19), (300, 19), (700,), (300,))
</pre></div>
</div>
<p>Here we are going to train 5 models</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare models</span>
<span class="n">lgbmparameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;XGB&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">()))</span>
<span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;CART&#39;</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">()))</span>
<span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;LGBM&#39;</span><span class="p">,</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">lgbmparameters</span><span class="p">)))</span>
<span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">()))</span>
<span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;NB&#39;</span><span class="p">,</span> <span class="n">GaussianNB</span><span class="p">()))</span>
<span class="c1"># evaluate each model in turn</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;roc_auc&#39;</span>
<span class="n">n_splits</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
        <span class="n">kfold</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">)</span>
        <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cv_results</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%f</span><span class="s2"> (</span><span class="si">%f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cv_results</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cv_results</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>XGB: 0.720764 (0.055151)
CART: 0.598842 (0.066576)
LGBM: 0.733702 (0.062989)
RF: 0.722074 (0.052949)
NB: 0.685554 (0.082030)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">box_1</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">n_splits</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;XGB&#39;</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;XGB&quot;</span>
<span class="p">)</span>
<span class="n">box_2</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">n_splits</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;CART&#39;</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;CART&quot;</span>
<span class="p">)</span>
<span class="n">box_3</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">n_splits</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;LGBM&#39;</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LGBM&quot;</span>
<span class="p">)</span>
<span class="n">box_4</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">n_splits</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;RF&quot;</span>
<span class="p">)</span>
<span class="n">box_5</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">n_splits</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;NB&#39;</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NB&quot;</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">box_1</span><span class="p">,</span> <span class="n">box_2</span><span class="p">,</span> <span class="n">box_3</span><span class="p">,</span> <span class="n">box_4</span><span class="p">,</span> <span class="n">box_5</span><span class="p">]</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model Results&#39;</span>
    <span class="p">),</span>
    <span class="n">boxmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span>
<span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;box-age-cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Models" src="projects/2023-09-20-banking-risk-predict/models_train.png" /></p>
<p>The best models were RandomForest and LGBM, we are going to train this model and use Optuna for hyperparameter optimization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lgbm_model</span> <span class="o">=</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">lgbmparameters</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_prob_lgbm</span> <span class="o">=</span> <span class="n">lgbm_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the LGBM Model, the test AUC is: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob_lgbm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the LGBM Model, the test Accu is: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob_lgbm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">())))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>For the LGBM Model, the test AUC is: 0.7434670592565329
For the LGBM Model, the test Accu is: 0.7533333333333333
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_prob_rf</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the RandomForest Model, the test AUC is: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob_rf</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the RandomForest Model, the test Accu is: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob_rf</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">())))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>For the RandomForest Model, the test AUC is: 0.7218308007781692
For the RandomForest Model, the test Accu is: 0.7266666666666667
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="hyperparameter-optimization-using-optuna">
<h1>Hyperparameter Optimization using Optuna<a class="headerlink" href="#hyperparameter-optimization-using-optuna" title="Permalink to this heading">#</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">auc_ks_metric</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Input:</span>
<span class="sd">        y_prob: model predict prob</span>
<span class="sd">        y_test: target</span>
<span class="sd">    Output: Metrics of validation</span>
<span class="sd">        auc, ks (Kolmogorov-Smirnov)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">)</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
    <span class="n">ks</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tpr</span> <span class="o">-</span> <span class="n">fpr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">auc</span><span class="p">,</span> <span class="n">ks</span>

<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">balanced</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Input:</span>
<span class="sd">        trial: trial of the test</span>
<span class="sd">        X_train:</span>
<span class="sd">        y_train:</span>
<span class="sd">        X_test:</span>
<span class="sd">        y_test:</span>
<span class="sd">        balanced:balanced or None</span>
<span class="sd">        method: XGBoost, CatBoost or LGBM</span>
<span class="sd">    Output: Metrics of validation</span>
<span class="sd">        auc, ks, log_loss</span>
<span class="sd">        auc_logloss_ks(y_test, y_pred)[0]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;LGBM&#39;</span><span class="p">:</span>
        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="s1">&#39;num_leaves&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;num_leaves&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
                      <span class="s1">&#39;lambda_l1&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;lambda_l1&quot;</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="s1">&#39;lambda_l2&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;lambda_l2&quot;</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="s1">&#39;min_data_in_leaf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_data_in_leaf&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                      <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
                      <span class="s1">&#39;feature_fraction&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;feature_fraction&quot;</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                      <span class="s1">&#39;bagging_fraction&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;bagging_fraction&quot;</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                      <span class="s1">&#39;bagging_freq&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">&quot;bagging_freq&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                      <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
  
                     <span class="p">}</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">param_grid</span><span class="p">,</span><span class="n">tree_method</span><span class="o">=</span><span class="s1">&#39;gpu_hist&#39;</span><span class="p">,</span><span class="n">gpu_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LGBM - Optimization using optuna&#39;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;RF&#39;</span><span class="p">:</span>
        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
                      <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_features&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                      <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
                      <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
                      <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">&quot;min_samples_split&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                      <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">&quot;n_estimators&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
  
                     <span class="p">}</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">param_grid</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RandomForest - Optimization using optuna&#39;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;XGBoost&#39;</span><span class="p">:</span>
        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
                      <span class="s1">&#39;min_child_weight&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;min_child_weight&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
                      <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
                      <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
                      <span class="s1">&#39;lambda&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
                      <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;colsample_bytree&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
                      <span class="s1">&#39;booster&#39;</span><span class="p">:</span> <span class="s1">&#39;gbtree&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                     <span class="p">}</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">param_grid</span><span class="p">,</span><span class="n">tree_method</span><span class="o">=</span><span class="s1">&#39;gpu_hist&#39;</span><span class="p">,</span><span class="n">gpu_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XGBoost - Optimization using optuna&#39;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">auc_res</span> <span class="o">=</span> <span class="n">auc_ks_metric</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;auc:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">auc_res</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">auc_ks_metric</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">tuning</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">balanced</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Input:</span>
<span class="sd">        trial: </span>
<span class="sd">        x_train:</span>
<span class="sd">        y_train:</span>
<span class="sd">        X_test:</span>
<span class="sd">        y_test:</span>
<span class="sd">        balanced:balanced or not balanced</span>
<span class="sd">        method: XGBoost, CatBoost or LGBM</span>
<span class="sd">    Output: Metrics of validation</span>
<span class="sd">        auc, ks, log_loss</span>
<span class="sd">        auc_logloss_ks(y_test, y_pred)[0]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="n">study_name</span><span class="o">=</span><span class="n">method</span><span class="o">+</span><span class="s1">&#39; Classifier&#39;</span><span class="p">)</span>
    <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="n">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">balanced</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting the optimization&#39;</span><span class="p">)</span>
    <span class="n">time_max_tuning</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">30</span> <span class="c1"># max time in seconds to stop</span>
    <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">time_max_tuning</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">study</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">balanced</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Input:</span>
<span class="sd">        X_train:</span>
<span class="sd">        y_train:</span>
<span class="sd">        X_test:</span>
<span class="sd">        y_test:</span>
<span class="sd">        balanced:balanced or None</span>
<span class="sd">        method: XGBoost, CatBoost or LGBM</span>
<span class="sd">    Output: predict model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tuning&#39;</span><span class="p">)</span>
    <span class="n">study</span> <span class="o">=</span> <span class="n">tuning</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">balanced</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;LGBM&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">study</span><span class="o">.</span><span class="n">best_params</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Last Fit&#39;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)],</span>
                 <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">lightgbm</span><span class="o">.</span><span class="n">early_stopping</span><span class="p">(</span><span class="n">stopping_rounds</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">lightgbm</span><span class="o">.</span><span class="n">log_evaluation</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">5000</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;XGBoost&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">study</span><span class="o">.</span><span class="n">best_params</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Last Fit&#39;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)],</span>
                 <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;RF&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">study</span><span class="o">.</span><span class="n">best_params</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Last Fit&#39;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">study</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lgbm_model</span><span class="p">,</span> <span class="n">study_lgbm</span> <span class="o">=</span> <span class="n">train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">balanced</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;LGBM&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[I 2023-09-25 07:48:59,504] A new study created in memory with name: LGBM Classifier
[I 2023-09-25 07:48:59,607] Trial 0 finished with value: 0.7707818497292181 and parameters: {&#39;learning_rate&#39;: 0.04564317750022488, &#39;num_leaves&#39;: 254, &#39;lambda_l1&#39;: 0.17602474289716696, &#39;lambda_l2&#39;: 2.936736356867574, &#39;min_data_in_leaf&#39;: 92, &#39;max_depth&#39;: 41, &#39;feature_fraction&#39;: 0.630771183128692, &#39;bagging_fraction&#39;: 0.8791863972428846, &#39;bagging_freq&#39;: 5}. Best is trial 0 with value: 0.7707818497292181.
[I 2023-09-25 07:48:59,695] Trial 1 finished with value: 0.7673905042326096 and parameters: {&#39;learning_rate&#39;: 0.03163545356039165, &#39;num_leaves&#39;: 93, &#39;lambda_l1&#39;: 5.331694642994698e-07, &#39;lambda_l2&#39;: 0.0016117988828970487, &#39;min_data_in_leaf&#39;: 62, &#39;max_depth&#39;: 17, &#39;feature_fraction&#39;: 0.5207793700543741, &#39;bagging_fraction&#39;: 0.6988688771949946, &#39;bagging_freq&#39;: 2}. Best is trial 0 with value: 0.7707818497292181.


Tuning
Starting the optimization
LGBM - Optimization using optuna
auc:0.7707818497292181
LGBM - Optimization using optuna
auc:0.7673905042326096
LGBM - Optimization using optuna


[I 2023-09-25 07:48:59,778] Trial 2 finished with value: 0.7639202902360797 and parameters: {&#39;learning_rate&#39;: 0.00032903168736575527, &#39;num_leaves&#39;: 221, &#39;lambda_l1&#39;: 0.013182095631109458, &#39;lambda_l2&#39;: 0.004903360053701577, &#39;min_data_in_leaf&#39;: 50, &#39;max_depth&#39;: 35, &#39;feature_fraction&#39;: 0.81375010947157, &#39;bagging_fraction&#39;: 0.47255383236900694, &#39;bagging_freq&#39;: 6}. Best is trial 0 with value: 0.7707818497292181.
[I 2023-09-25 07:48:59,870] Trial 3 finished with value: 0.7488301172511699 and parameters: {&#39;learning_rate&#39;: 0.07583419812542502, &#39;num_leaves&#39;: 227, &#39;lambda_l1&#39;: 0.001263229821256988, &#39;lambda_l2&#39;: 0.6714031923624736, &#39;min_data_in_leaf&#39;: 23, &#39;max_depth&#39;: 48, &#39;feature_fraction&#39;: 0.47371647441012454, &#39;bagging_fraction&#39;: 0.5357410570154348, &#39;bagging_freq&#39;: 3}. Best is trial 0 with value: 0.7707818497292181.
[I 2023-09-25 07:48:59,958] Trial 4 finished with value: 0.7586361007413639 and parameters: {&#39;learning_rate&#39;: 0.0001610953746996855, &#39;num_leaves&#39;: 228, &#39;lambda_l1&#39;: 4.74483283120879, &#39;lambda_l2&#39;: 0.00011656154418021165, &#39;min_data_in_leaf&#39;: 88, &#39;max_depth&#39;: 60, &#39;feature_fraction&#39;: 0.5768682497889083, &#39;bagging_fraction&#39;: 0.9363888441877074, &#39;bagging_freq&#39;: 5}. Best is trial 0 with value: 0.7707818497292181.


auc:0.7639202902360797
LGBM - Optimization using optuna
auc:0.7488301172511699
LGBM - Optimization using optuna
auc:0.7586361007413639
LGBM - Optimization using optuna


[I 2023-09-25 07:49:00,049] Trial 5 finished with value: 0.7586098112413902 and parameters: {&#39;learning_rate&#39;: 0.0001249838804070837, &#39;num_leaves&#39;: 62, &#39;lambda_l1&#39;: 1.0950722639611093e-08, &#39;lambda_l2&#39;: 1.6247452419757427, &#39;min_data_in_leaf&#39;: 88, &#39;max_depth&#39;: 20, &#39;feature_fraction&#39;: 0.7390198578425595, &#39;bagging_fraction&#39;: 0.5451921961124094, &#39;bagging_freq&#39;: 4}. Best is trial 0 with value: 0.7707818497292181.
[I 2023-09-25 07:49:00,135] Trial 6 finished with value: 0.7462274567537727 and parameters: {&#39;learning_rate&#39;: 0.021165567217590234, &#39;num_leaves&#39;: 219, &#39;lambda_l1&#39;: 2.634681758289909e-06, &#39;lambda_l2&#39;: 2.1170808617536877e-06, &#39;min_data_in_leaf&#39;: 70, &#39;max_depth&#39;: 52, &#39;feature_fraction&#39;: 0.8886838094462373, &#39;bagging_fraction&#39;: 0.7972849312237408, &#39;bagging_freq&#39;: 5}. Best is trial 0 with value: 0.7707818497292181.
[I 2023-09-25 07:49:00,229] Trial 7 finished with value: 0.7455702192544299 and parameters: {&#39;learning_rate&#39;: 0.028054358171711414, &#39;num_leaves&#39;: 106, &#39;lambda_l1&#39;: 0.2794244438193041, &#39;lambda_l2&#39;: 0.02038032703976737, &#39;min_data_in_leaf&#39;: 41, &#39;max_depth&#39;: 8, &#39;feature_fraction&#39;: 0.9320015422653435, &#39;bagging_fraction&#39;: 0.97584085801718, &#39;bagging_freq&#39;: 1}. Best is trial 0 with value: 0.7707818497292181.

[I 2023-09-25 08:18:59,736] Trial 5841 finished with value: 0.7210946947789053 and parameters: {&#39;learning_rate&#39;: 0.0017454581670019865, &#39;num_leaves&#39;: 71, &#39;lambda_l1&#39;: 0.00030822208833371846, &#39;lambda_l2&#39;: 0.001178948478008598, &#39;min_data_in_leaf&#39;: 82, &#39;max_depth&#39;: 64, &#39;feature_fraction&#39;: 0.9975320930746641, &#39;bagging_fraction&#39;: 0.9612726835980929, &#39;bagging_freq&#39;: 1}. Best is trial 3444 with value: 0.7828487302171513.


LGBM - Optimization using optuna
auc:0.7210946947789053
Last Fit
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_prob_lgbm</span> <span class="o">=</span> <span class="n">lgbm_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[LightGBM] [Warning] min_data_in_leaf is set=81, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=81
[LightGBM] [Warning] feature_fraction is set=0.5174527298564775, colsample_bytree=1.0 will be ignored. Current value: feature_fraction=0.5174527298564775
[LightGBM] [Warning] lambda_l2 is set=0.0003124668197733085, reg_lambda=0.0 will be ignored. Current value: lambda_l2=0.0003124668197733085
[LightGBM] [Warning] lambda_l1 is set=2.524882043205203e-06, reg_alpha=0.0 will be ignored. Current value: lambda_l1=2.524882043205203e-06
[LightGBM] [Warning] bagging_fraction is set=0.7962210156422196, subsample=1.0 will be ignored. Current value: bagging_fraction=0.7962210156422196
[LightGBM] [Warning] bagging_freq is set=1, subsample_freq=0 will be ignored. Current value: bagging_freq=1
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the LGBM Model, the test AUC is: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob_lgbm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the LGBM Model, the KS is: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">auc_ks_metric</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob_lgbm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the LGBM Model, the test Accu is: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob_lgbm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">())))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>For the LGBM Model, the test AUC is: 0.7828487302171513
For the LGBM Model, the KS is: 0.4945580735054419
For the LGBM Model, the test Accu is: 0.7133333333333334
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">confusion_hard</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_prob_lgbm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_hard</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">190</span><span class="p">,</span><span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Confusion Matrix&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Confusion Matrix in LGBM
<img alt="png" src="projects/2023-09-20-banking-risk-predict/output_77_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate ROC curve values: fpr, tpr, thresholds</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_prob_lgbm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Plot ROC curve</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Curve&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="png" src="projects/2023-09-20-banking-risk-predict/output_78_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_param_importances</span><span class="p">(</span><span class="n">study_lgbm</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rf_model</span><span class="p">,</span> <span class="n">study_rf</span> <span class="o">=</span> <span class="n">train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">balanced</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;RF&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[I 2023-09-25 08:32:34,955] A new study created in memory with name: RF Classifier


Tuning
Starting the optimization
RandomForest - Optimization using optuna


[I 2023-09-25 08:32:35,237] Trial 0 finished with value: 0.7599768652400232 and parameters: {&#39;max_features&#39;: 7, &#39;min_samples_leaf&#39;: 21, &#39;max_depth&#39;: 25, &#39;min_samples_split&#39;: 24, &#39;n_estimators&#39;: 231}. Best is trial 0 with value: 0.7599768652400232.


auc:0.7599768652400232
RandomForest - Optimization using optuna


[I 2023-09-25 08:32:36,115] Trial 1 finished with value: 0.7550344392449656 and parameters: {&#39;max_features&#39;: 6, &#39;min_samples_leaf&#39;: 25, &#39;max_depth&#39;: 63, &#39;min_samples_split&#39;: 27, &#39;n_estimators&#39;: 1132}. Best is trial 0 with value: 0.7599768652400232.

Last Fit
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_prob_rf</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the RandomForest Model, the test AUC is: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob_rf</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the RandomForest, the KS is: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">auc_ks_metric</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob_rf</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the RandomForest Model, the test Accu is: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob_rf</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">())))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>For the RandomForest Model, the test AUC is: 0.7489352752510646
For the RandomForest, the KS is: 0.40080971659919035
For the RandomForest Model, the test Accu is: 0.7233333333333334
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">confusion_hard</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_prob_rf</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_hard</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">190</span><span class="p">,</span><span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Confusion Matrix&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Confusion Matrix in RandomForest
<img alt="png" src="projects/2023-09-20-banking-risk-predict/output_83_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate ROC curve values: fpr, tpr, thresholds</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_prob_rf</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Plot ROC curve</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Curve&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="png" src="projects/2023-09-20-banking-risk-predict/output_84_0.png" /></p>
<p>LGBM model has a better performance after the optimization using Optuna, so we’ll this model as our final model.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="ranking-the-final-model">
<h1>Ranking the final model<a class="headerlink" href="#ranking-the-final-model" title="Permalink to this heading">#</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shap</span>
<span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">TreeExplainer</span><span class="p">(</span><span class="n">lgbm_model</span><span class="p">)</span>
<span class="n">shap_values</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">shap</span><span class="o">.</span><span class="n">summary_plot</span><span class="p">(</span><span class="n">shap_values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_train</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>SHAP results in LGBM
<img alt="png" src="projects/2023-09-20-banking-risk-predict/output_88_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shap_test</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LightGBM binary classifier with TreeExplainer shap values output has changed to a list of ndarray
</pre></div>
</div>
<p>Here we are going to create new variables from shap. The goal is to make more easier to use our final model, for example we want to select the clients with high scores and have more cash in their checking account</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">shap_col</span><span class="p">(</span><span class="n">shap_</span><span class="p">):</span>
    <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Job&#39;</span><span class="p">,</span> <span class="s1">&#39;Saving accounts&#39;</span><span class="p">,</span> <span class="s1">&#39;Checking account&#39;</span><span class="p">,</span> <span class="s1">&#39;Credit amount&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="s1">&#39;sex_female&#39;</span><span class="p">,</span> <span class="s1">&#39;sex_male&#39;</span><span class="p">,</span> <span class="s1">&#39;hous_free&#39;</span><span class="p">,</span> <span class="s1">&#39;hous_own&#39;</span><span class="p">,</span>
       <span class="s1">&#39;hous_rent&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_business&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_car&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_domestic appliances&#39;</span><span class="p">,</span>
       <span class="s1">&#39;purp_education&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_furniture/equipment&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_radio/TV&#39;</span><span class="p">,</span>
       <span class="s1">&#39;purp_repairs&#39;</span><span class="p">,</span> <span class="s1">&#39;purp_vacation/others&#39;</span><span class="p">]</span>
    <span class="n">df_shap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">shap_test</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
<span class="c1">#     shap_cols = {}</span>
<span class="c1">#     shap_cols[&#39;shap_1&#39;] = np.nan</span>
<span class="c1">#     shap_cols[&#39;shap_2&#39;] = np.nan</span>
<span class="c1">#     shap_cols[&#39;shap_3&#39;] = np.nan</span>
<span class="c1">#     shap_cols[&#39;shap_4&#39;] = np.nan</span>
<span class="c1">#     shap_cols[&#39;shap_5&#39;] = np.nan</span>
<span class="c1">#     shap_cols[&#39;shap_6&#39;] = np.nan</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;Checking account&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Little Check Account&#39;</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;Duration&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;More Credit Duration&#39;</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;Credit amount&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;More Credit Amount&#39;</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;More Junior Client&#39;</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;hous_own&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Have House&#39;</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;purp_radio/TV&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;The purpose is to buy Radio/TV&#39;</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;Checking account&#39;</span><span class="p">]</span><span class="o">&lt;-</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Moderate/Rich Check Account&#39;</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;Duration&#39;</span><span class="p">]</span><span class="o">&lt;-</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Less Credit Duration&#39;</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;Credit amount&#39;</span><span class="p">]</span><span class="o">&lt;-</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_9&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Less Credit Amount&#39;</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span><span class="o">&lt;-</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;More Senior Client&#39;</span>
    <span class="n">df_shap</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_shap</span><span class="p">[</span><span class="s1">&#39;hous_own&#39;</span><span class="p">]</span><span class="o">&lt;-</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;shap_11&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Does not have House&#39;</span>
<span class="c1"># pd.DataFrame(shap_test[1],columns=col).apply(shap_col, axis=1, result_type=&#39;expand&#39;)</span>

    <span class="k">return</span> <span class="n">df_shap</span><span class="p">[[</span><span class="s1">&#39;shap_1&#39;</span><span class="p">,</span><span class="s1">&#39;shap_2&#39;</span><span class="p">,</span><span class="s1">&#39;shap_3&#39;</span><span class="p">,</span><span class="s1">&#39;shap_4&#39;</span><span class="p">,</span><span class="s1">&#39;shap_5&#39;</span><span class="p">,</span><span class="s1">&#39;shap_6&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;shap_7&#39;</span><span class="p">,</span><span class="s1">&#39;shap_8&#39;</span><span class="p">,</span><span class="s1">&#39;shap_9&#39;</span><span class="p">,</span><span class="s1">&#39;shap_10&#39;</span><span class="p">,</span><span class="s1">&#39;shap_11&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_shap_arg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">shap_col</span><span class="p">(</span><span class="n">shap_test</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_shap_arg</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>shap_1</th>
      <th>shap_2</th>
      <th>shap_3</th>
      <th>shap_4</th>
      <th>shap_5</th>
      <th>shap_6</th>
      <th>shap_7</th>
      <th>shap_8</th>
      <th>shap_9</th>
      <th>shap_10</th>
      <th>shap_11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Little Check Account</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>More Junior Client</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Less Credit Amount</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Little Check Account</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Little Check Account</td>
      <td>More Credit Duration</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Less Credit Amount</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Little Check Account</td>
      <td>NaN</td>
      <td>More Credit Amount</td>
      <td>More Junior Client</td>
      <td>Have House</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Less Credit Duration</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>More Credit Amount</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Moderate/Rich Check Account</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>More Senior Client</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>295</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>More Junior Client</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Moderate/Rich Check Account</td>
      <td>NaN</td>
      <td>Less Credit Amount</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>296</th>
      <td>Little Check Account</td>
      <td>More Credit Duration</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>297</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>More Credit Amount</td>
      <td>More Junior Client</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Moderate/Rich Check Account</td>
      <td>Less Credit Duration</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>298</th>
      <td>Little Check Account</td>
      <td>More Credit Duration</td>
      <td>More Credit Amount</td>
      <td>NaN</td>
      <td>Have House</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>299</th>
      <td>Little Check Account</td>
      <td>NaN</td>
      <td>More Credit Amount</td>
      <td>More Junior Client</td>
      <td>Have House</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Less Credit Duration</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>300 rows × 11 columns</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_test</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> <span class="p">,</span><span class="n">df_shap_arg</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>Age</th>
      <th>Job</th>
      <th>Saving accounts</th>
      <th>Checking account</th>
      <th>Credit amount</th>
      <th>Duration</th>
      <th>sex_female</th>
      <th>sex_male</th>
      <th>hous_free</th>
      <th>...</th>
      <th>shap_2</th>
      <th>shap_3</th>
      <th>shap_4</th>
      <th>shap_5</th>
      <th>shap_6</th>
      <th>shap_7</th>
      <th>shap_8</th>
      <th>shap_9</th>
      <th>shap_10</th>
      <th>shap_11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>521</td>
      <td>24</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>3190</td>
      <td>18</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>More Junior Client</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Less Credit Amount</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>737</td>
      <td>35</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>4380</td>
      <td>18</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>740</td>
      <td>32</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>2325</td>
      <td>24</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>More Credit Duration</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Less Credit Amount</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>660</td>
      <td>23</td>
      <td>2</td>
      <td>1</td>
      <td>3</td>
      <td>1297</td>
      <td>12</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>More Credit Amount</td>
      <td>More Junior Client</td>
      <td>Have House</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Less Credit Duration</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>411</td>
      <td>35</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>7253</td>
      <td>33</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>More Credit Amount</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Moderate/Rich Check Account</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>More Senior Client</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>295</th>
      <td>468</td>
      <td>26</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>2764</td>
      <td>33</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>More Junior Client</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Moderate/Rich Check Account</td>
      <td>NaN</td>
      <td>Less Credit Amount</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>296</th>
      <td>935</td>
      <td>30</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>1919</td>
      <td>30</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>More Credit Duration</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>297</th>
      <td>428</td>
      <td>20</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>1313</td>
      <td>9</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>More Credit Amount</td>
      <td>More Junior Client</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Moderate/Rich Check Account</td>
      <td>Less Credit Duration</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>298</th>
      <td>7</td>
      <td>35</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>6948</td>
      <td>36</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>More Credit Duration</td>
      <td>More Credit Amount</td>
      <td>NaN</td>
      <td>Have House</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>299</th>
      <td>155</td>
      <td>20</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1282</td>
      <td>12</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>NaN</td>
      <td>More Credit Amount</td>
      <td>More Junior Client</td>
      <td>Have House</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Less Credit Duration</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>300 rows × 32 columns</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span> <span class="o">=</span> <span class="n">df_final</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>creating a column score from our predeict_proba</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_prob_lgbm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>we will divide our clients into 5 groups based on the score, this number we can use any number to see if our model is ordering some variables</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">df_final</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Group by some variables</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">)[[</span><span class="s1">&#39;Checking account&#39;</span><span class="p">,</span><span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span><span class="s1">&#39;Credit amount&#39;</span><span class="p">,</span> <span class="s1">&#39;hous_own&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Saving accounts&#39;</span><span class="p">,</span><span class="s1">&#39;purp_radio/TV&#39;</span><span class="p">,</span><span class="s1">&#39;purp_car&#39;</span><span class="p">,</span><span class="s1">&#39;sex_male&#39;</span><span class="p">,</span><span class="s1">&#39;sex_female&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Checking account</th>
      <th>Duration</th>
      <th>Age</th>
      <th>Credit amount</th>
      <th>hous_own</th>
      <th>Saving accounts</th>
      <th>purp_radio/TV</th>
      <th>purp_car</th>
      <th>sex_male</th>
      <th>sex_female</th>
    </tr>
    <tr>
      <th>rank</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.083333</td>
      <td>15.350000</td>
      <td>41.300000</td>
      <td>2261.750000</td>
      <td>0.900000</td>
      <td>1.183333</td>
      <td>0.400000</td>
      <td>0.300000</td>
      <td>0.766667</td>
      <td>0.233333</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.716667</td>
      <td>16.266667</td>
      <td>35.266667</td>
      <td>2352.266667</td>
      <td>0.783333</td>
      <td>1.283333</td>
      <td>0.216667</td>
      <td>0.266667</td>
      <td>0.766667</td>
      <td>0.233333</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.216667</td>
      <td>18.566667</td>
      <td>36.950000</td>
      <td>3140.466667</td>
      <td>0.766667</td>
      <td>1.033333</td>
      <td>0.250000</td>
      <td>0.300000</td>
      <td>0.683333</td>
      <td>0.316667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.450000</td>
      <td>18.466667</td>
      <td>33.133333</td>
      <td>2666.100000</td>
      <td>0.683333</td>
      <td>1.283333</td>
      <td>0.266667</td>
      <td>0.383333</td>
      <td>0.716667</td>
      <td>0.283333</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.383333</td>
      <td>31.783333</td>
      <td>31.700000</td>
      <td>4354.200000</td>
      <td>0.383333</td>
      <td>1.033333</td>
      <td>0.166667</td>
      <td>0.333333</td>
      <td>0.600000</td>
      <td>0.400000</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">)[[</span><span class="s1">&#39;Checking account&#39;</span><span class="p">,</span><span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span><span class="s1">&#39;Credit amount&#39;</span><span class="p">,</span> <span class="s1">&#39;hous_own&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Saving accounts&#39;</span><span class="p">,</span><span class="s1">&#39;purp_radio/TV&#39;</span><span class="p">,</span><span class="s1">&#39;purp_car&#39;</span><span class="p">,</span><span class="s1">&#39;sex_male&#39;</span><span class="p">,</span><span class="s1">&#39;sex_female&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#d65f5f&#39;</span><span class="p">,</span> <span class="s1">&#39;#5fba7d&#39;</span><span class="p">])</span>
</pre></div>
</div>
<style type="text/css">
#T_7d04a_row0_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 5.7%, transparent 5.7%);
}
#T_7d04a_row0_col1 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 48.3%, transparent 48.3%);
}
#T_7d04a_row0_col2, #T_7d04a_row0_col4, #T_7d04a_row0_col6, #T_7d04a_row0_col8, #T_7d04a_row1_col5, #T_7d04a_row1_col8, #T_7d04a_row3_col0, #T_7d04a_row3_col5, #T_7d04a_row3_col7, #T_7d04a_row4_col1, #T_7d04a_row4_col3, #T_7d04a_row4_col9 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 100.0%, transparent 100.0%);
}
#T_7d04a_row0_col3 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 51.9%, transparent 51.9%);
}
#T_7d04a_row0_col5 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 92.2%, transparent 92.2%);
}
#T_7d04a_row0_col7, #T_7d04a_row2_col7, #T_7d04a_row4_col8 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 78.3%, transparent 78.3%);
}
#T_7d04a_row0_col9, #T_7d04a_row1_col9 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 58.3%, transparent 58.3%);
}
#T_7d04a_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 49.4%, transparent 49.4%);
}
#T_7d04a_row1_col1 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 51.2%, transparent 51.2%);
}
#T_7d04a_row1_col2 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 85.4%, transparent 85.4%);
}
#T_7d04a_row1_col3 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 54.0%, transparent 54.0%);
}
#T_7d04a_row1_col4, #T_7d04a_row4_col7 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 87.0%, transparent 87.0%);
}
#T_7d04a_row1_col6 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 54.2%, transparent 54.2%);
}
#T_7d04a_row1_col7 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 69.6%, transparent 69.6%);
}
#T_7d04a_row2_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 83.9%, transparent 83.9%);
}
#T_7d04a_row2_col1 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 58.4%, transparent 58.4%);
}
#T_7d04a_row2_col2 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 89.5%, transparent 89.5%);
}
#T_7d04a_row2_col3 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 72.1%, transparent 72.1%);
}
#T_7d04a_row2_col4 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 85.2%, transparent 85.2%);
}
#T_7d04a_row2_col5, #T_7d04a_row4_col5 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 80.5%, transparent 80.5%);
}
#T_7d04a_row2_col6 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 62.5%, transparent 62.5%);
}
#T_7d04a_row2_col8 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 89.1%, transparent 89.1%);
}
#T_7d04a_row2_col9 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 79.2%, transparent 79.2%);
}
#T_7d04a_row3_col1 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 58.1%, transparent 58.1%);
}
#T_7d04a_row3_col2 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 80.2%, transparent 80.2%);
}
#T_7d04a_row3_col3 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 61.2%, transparent 61.2%);
}
#T_7d04a_row3_col4 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 75.9%, transparent 75.9%);
}
#T_7d04a_row3_col6 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 66.7%, transparent 66.7%);
}
#T_7d04a_row3_col8 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 93.5%, transparent 93.5%);
}
#T_7d04a_row3_col9 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 70.8%, transparent 70.8%);
}
#T_7d04a_row4_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 95.4%, transparent 95.4%);
}
#T_7d04a_row4_col2 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 76.8%, transparent 76.8%);
}
#T_7d04a_row4_col4 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 42.6%, transparent 42.6%);
}
#T_7d04a_row4_col6 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 41.7%, transparent 41.7%);
}
</style>
<table id="T_7d04a">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_7d04a_level0_col0" class="col_heading level0 col0" >Checking account</th>
      <th id="T_7d04a_level0_col1" class="col_heading level0 col1" >Duration</th>
      <th id="T_7d04a_level0_col2" class="col_heading level0 col2" >Age</th>
      <th id="T_7d04a_level0_col3" class="col_heading level0 col3" >Credit amount</th>
      <th id="T_7d04a_level0_col4" class="col_heading level0 col4" >hous_own</th>
      <th id="T_7d04a_level0_col5" class="col_heading level0 col5" >Saving accounts</th>
      <th id="T_7d04a_level0_col6" class="col_heading level0 col6" >purp_radio/TV</th>
      <th id="T_7d04a_level0_col7" class="col_heading level0 col7" >purp_car</th>
      <th id="T_7d04a_level0_col8" class="col_heading level0 col8" >sex_male</th>
      <th id="T_7d04a_level0_col9" class="col_heading level0 col9" >sex_female</th>
    </tr>
    <tr>
      <th class="index_name level0" >rank</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
      <th class="blank col7" >&nbsp;</th>
      <th class="blank col8" >&nbsp;</th>
      <th class="blank col9" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_7d04a_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_7d04a_row0_col0" class="data row0 col0" >0.083333</td>
      <td id="T_7d04a_row0_col1" class="data row0 col1" >15.350000</td>
      <td id="T_7d04a_row0_col2" class="data row0 col2" >41.300000</td>
      <td id="T_7d04a_row0_col3" class="data row0 col3" >2261.750000</td>
      <td id="T_7d04a_row0_col4" class="data row0 col4" >0.900000</td>
      <td id="T_7d04a_row0_col5" class="data row0 col5" >1.183333</td>
      <td id="T_7d04a_row0_col6" class="data row0 col6" >0.400000</td>
      <td id="T_7d04a_row0_col7" class="data row0 col7" >0.300000</td>
      <td id="T_7d04a_row0_col8" class="data row0 col8" >0.766667</td>
      <td id="T_7d04a_row0_col9" class="data row0 col9" >0.233333</td>
    </tr>
    <tr>
      <th id="T_7d04a_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_7d04a_row1_col0" class="data row1 col0" >0.716667</td>
      <td id="T_7d04a_row1_col1" class="data row1 col1" >16.266667</td>
      <td id="T_7d04a_row1_col2" class="data row1 col2" >35.266667</td>
      <td id="T_7d04a_row1_col3" class="data row1 col3" >2352.266667</td>
      <td id="T_7d04a_row1_col4" class="data row1 col4" >0.783333</td>
      <td id="T_7d04a_row1_col5" class="data row1 col5" >1.283333</td>
      <td id="T_7d04a_row1_col6" class="data row1 col6" >0.216667</td>
      <td id="T_7d04a_row1_col7" class="data row1 col7" >0.266667</td>
      <td id="T_7d04a_row1_col8" class="data row1 col8" >0.766667</td>
      <td id="T_7d04a_row1_col9" class="data row1 col9" >0.233333</td>
    </tr>
    <tr>
      <th id="T_7d04a_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_7d04a_row2_col0" class="data row2 col0" >1.216667</td>
      <td id="T_7d04a_row2_col1" class="data row2 col1" >18.566667</td>
      <td id="T_7d04a_row2_col2" class="data row2 col2" >36.950000</td>
      <td id="T_7d04a_row2_col3" class="data row2 col3" >3140.466667</td>
      <td id="T_7d04a_row2_col4" class="data row2 col4" >0.766667</td>
      <td id="T_7d04a_row2_col5" class="data row2 col5" >1.033333</td>
      <td id="T_7d04a_row2_col6" class="data row2 col6" >0.250000</td>
      <td id="T_7d04a_row2_col7" class="data row2 col7" >0.300000</td>
      <td id="T_7d04a_row2_col8" class="data row2 col8" >0.683333</td>
      <td id="T_7d04a_row2_col9" class="data row2 col9" >0.316667</td>
    </tr>
    <tr>
      <th id="T_7d04a_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_7d04a_row3_col0" class="data row3 col0" >1.450000</td>
      <td id="T_7d04a_row3_col1" class="data row3 col1" >18.466667</td>
      <td id="T_7d04a_row3_col2" class="data row3 col2" >33.133333</td>
      <td id="T_7d04a_row3_col3" class="data row3 col3" >2666.100000</td>
      <td id="T_7d04a_row3_col4" class="data row3 col4" >0.683333</td>
      <td id="T_7d04a_row3_col5" class="data row3 col5" >1.283333</td>
      <td id="T_7d04a_row3_col6" class="data row3 col6" >0.266667</td>
      <td id="T_7d04a_row3_col7" class="data row3 col7" >0.383333</td>
      <td id="T_7d04a_row3_col8" class="data row3 col8" >0.716667</td>
      <td id="T_7d04a_row3_col9" class="data row3 col9" >0.283333</td>
    </tr>
    <tr>
      <th id="T_7d04a_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_7d04a_row4_col0" class="data row4 col0" >1.383333</td>
      <td id="T_7d04a_row4_col1" class="data row4 col1" >31.783333</td>
      <td id="T_7d04a_row4_col2" class="data row4 col2" >31.700000</td>
      <td id="T_7d04a_row4_col3" class="data row4 col3" >4354.200000</td>
      <td id="T_7d04a_row4_col4" class="data row4 col4" >0.383333</td>
      <td id="T_7d04a_row4_col5" class="data row4 col5" >1.033333</td>
      <td id="T_7d04a_row4_col6" class="data row4 col6" >0.166667</td>
      <td id="T_7d04a_row4_col7" class="data row4 col7" >0.333333</td>
      <td id="T_7d04a_row4_col8" class="data row4 col8" >0.600000</td>
      <td id="T_7d04a_row4_col9" class="data row4 col9" >0.400000</td>
    </tr>
  </tbody>
</table>
<p>We managed to create a good discrimination between our audience with higher scores and those with lower scores</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">)[[</span><span class="s1">&#39;Risk&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#d65f5f&#39;</span><span class="p">,</span> <span class="s1">&#39;#5fba7d&#39;</span><span class="p">])</span>
</pre></div>
</div>
<style type="text/css">
#T_5712f_row0_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 11.1%, transparent 11.1%);
}
#T_5712f_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 22.2%, transparent 22.2%);
}
#T_5712f_row2_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 36.1%, transparent 36.1%);
}
#T_5712f_row3_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 83.3%, transparent 83.3%);
}
#T_5712f_row4_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 100.0%, transparent 100.0%);
}
</style>
<table id="T_5712f">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_5712f_level0_col0" class="col_heading level0 col0" >Risk</th>
    </tr>
    <tr>
      <th class="index_name level0" >rank</th>
      <th class="blank col0" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_5712f_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_5712f_row0_col0" class="data row0 col0" >4</td>
    </tr>
    <tr>
      <th id="T_5712f_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_5712f_row1_col0" class="data row1 col0" >8</td>
    </tr>
    <tr>
      <th id="T_5712f_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_5712f_row2_col0" class="data row2 col0" >13</td>
    </tr>
    <tr>
      <th id="T_5712f_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_5712f_row3_col0" class="data row3 col0" >30</td>
    </tr>
    <tr>
      <th id="T_5712f_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_5712f_row4_col0" class="data row4 col0" >36</td>
    </tr>
  </tbody>
</table>
<p>We were able to order the amount of bad credit</p>
<p>we can see using other’s numbers to divide</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">df_final</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">df_final</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">)[[</span><span class="s1">&#39;Checking account&#39;</span><span class="p">,</span><span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span><span class="s1">&#39;Credit amount&#39;</span><span class="p">,</span> <span class="s1">&#39;hous_own&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Saving accounts&#39;</span><span class="p">,</span><span class="s1">&#39;purp_radio/TV&#39;</span><span class="p">,</span><span class="s1">&#39;purp_car&#39;</span><span class="p">,</span><span class="s1">&#39;sex_male&#39;</span><span class="p">,</span><span class="s1">&#39;sex_female&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Checking account</th>
      <th>Duration</th>
      <th>Age</th>
      <th>Credit amount</th>
      <th>hous_own</th>
      <th>Saving accounts</th>
      <th>purp_radio/TV</th>
      <th>purp_car</th>
      <th>sex_male</th>
      <th>sex_female</th>
    </tr>
    <tr>
      <th>rank</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.31</td>
      <td>15.43</td>
      <td>39.69</td>
      <td>2282.97</td>
      <td>0.86</td>
      <td>1.17</td>
      <td>0.36</td>
      <td>0.28</td>
      <td>0.77</td>
      <td>0.23</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.17</td>
      <td>18.19</td>
      <td>35.30</td>
      <td>2868.43</td>
      <td>0.77</td>
      <td>1.18</td>
      <td>0.20</td>
      <td>0.31</td>
      <td>0.71</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.43</td>
      <td>26.64</td>
      <td>32.02</td>
      <td>3713.47</td>
      <td>0.48</td>
      <td>1.14</td>
      <td>0.22</td>
      <td>0.36</td>
      <td>0.64</td>
      <td>0.36</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">)[[</span><span class="s1">&#39;Checking account&#39;</span><span class="p">,</span><span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span><span class="s1">&#39;Credit amount&#39;</span><span class="p">,</span> <span class="s1">&#39;hous_own&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Saving accounts&#39;</span><span class="p">,</span><span class="s1">&#39;purp_radio/TV&#39;</span><span class="p">,</span><span class="s1">&#39;purp_car&#39;</span><span class="p">,</span><span class="s1">&#39;sex_male&#39;</span><span class="p">,</span><span class="s1">&#39;sex_female&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#d65f5f&#39;</span><span class="p">,</span> <span class="s1">&#39;#5fba7d&#39;</span><span class="p">])</span>
</pre></div>
</div>
<style type="text/css">
#T_ee254_row0_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 21.7%, transparent 21.7%);
}
#T_ee254_row0_col1 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 57.9%, transparent 57.9%);
}
#T_ee254_row0_col2, #T_ee254_row0_col4, #T_ee254_row0_col6, #T_ee254_row0_col8, #T_ee254_row1_col5, #T_ee254_row2_col0, #T_ee254_row2_col1, #T_ee254_row2_col3, #T_ee254_row2_col7, #T_ee254_row2_col9 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 100.0%, transparent 100.0%);
}
#T_ee254_row0_col3 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 61.5%, transparent 61.5%);
}
#T_ee254_row0_col5 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 99.2%, transparent 99.2%);
}
#T_ee254_row0_col7 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 77.8%, transparent 77.8%);
}
#T_ee254_row0_col9 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 63.9%, transparent 63.9%);
}
#T_ee254_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 81.8%, transparent 81.8%);
}
#T_ee254_row1_col1 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 68.3%, transparent 68.3%);
}
#T_ee254_row1_col2 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 88.9%, transparent 88.9%);
}
#T_ee254_row1_col3 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 77.2%, transparent 77.2%);
}
#T_ee254_row1_col4 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 89.5%, transparent 89.5%);
}
#T_ee254_row1_col6 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 55.6%, transparent 55.6%);
}
#T_ee254_row1_col7 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 86.1%, transparent 86.1%);
}
#T_ee254_row1_col8 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 92.2%, transparent 92.2%);
}
#T_ee254_row1_col9 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 80.6%, transparent 80.6%);
}
#T_ee254_row2_col2 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 80.7%, transparent 80.7%);
}
#T_ee254_row2_col4 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 55.8%, transparent 55.8%);
}
#T_ee254_row2_col5 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 96.6%, transparent 96.6%);
}
#T_ee254_row2_col6 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 61.1%, transparent 61.1%);
}
#T_ee254_row2_col8 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 83.1%, transparent 83.1%);
}
</style>
<table id="T_ee254">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_ee254_level0_col0" class="col_heading level0 col0" >Checking account</th>
      <th id="T_ee254_level0_col1" class="col_heading level0 col1" >Duration</th>
      <th id="T_ee254_level0_col2" class="col_heading level0 col2" >Age</th>
      <th id="T_ee254_level0_col3" class="col_heading level0 col3" >Credit amount</th>
      <th id="T_ee254_level0_col4" class="col_heading level0 col4" >hous_own</th>
      <th id="T_ee254_level0_col5" class="col_heading level0 col5" >Saving accounts</th>
      <th id="T_ee254_level0_col6" class="col_heading level0 col6" >purp_radio/TV</th>
      <th id="T_ee254_level0_col7" class="col_heading level0 col7" >purp_car</th>
      <th id="T_ee254_level0_col8" class="col_heading level0 col8" >sex_male</th>
      <th id="T_ee254_level0_col9" class="col_heading level0 col9" >sex_female</th>
    </tr>
    <tr>
      <th class="index_name level0" >rank</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
      <th class="blank col7" >&nbsp;</th>
      <th class="blank col8" >&nbsp;</th>
      <th class="blank col9" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_ee254_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_ee254_row0_col0" class="data row0 col0" >0.310000</td>
      <td id="T_ee254_row0_col1" class="data row0 col1" >15.430000</td>
      <td id="T_ee254_row0_col2" class="data row0 col2" >39.690000</td>
      <td id="T_ee254_row0_col3" class="data row0 col3" >2282.970000</td>
      <td id="T_ee254_row0_col4" class="data row0 col4" >0.860000</td>
      <td id="T_ee254_row0_col5" class="data row0 col5" >1.170000</td>
      <td id="T_ee254_row0_col6" class="data row0 col6" >0.360000</td>
      <td id="T_ee254_row0_col7" class="data row0 col7" >0.280000</td>
      <td id="T_ee254_row0_col8" class="data row0 col8" >0.770000</td>
      <td id="T_ee254_row0_col9" class="data row0 col9" >0.230000</td>
    </tr>
    <tr>
      <th id="T_ee254_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_ee254_row1_col0" class="data row1 col0" >1.170000</td>
      <td id="T_ee254_row1_col1" class="data row1 col1" >18.190000</td>
      <td id="T_ee254_row1_col2" class="data row1 col2" >35.300000</td>
      <td id="T_ee254_row1_col3" class="data row1 col3" >2868.430000</td>
      <td id="T_ee254_row1_col4" class="data row1 col4" >0.770000</td>
      <td id="T_ee254_row1_col5" class="data row1 col5" >1.180000</td>
      <td id="T_ee254_row1_col6" class="data row1 col6" >0.200000</td>
      <td id="T_ee254_row1_col7" class="data row1 col7" >0.310000</td>
      <td id="T_ee254_row1_col8" class="data row1 col8" >0.710000</td>
      <td id="T_ee254_row1_col9" class="data row1 col9" >0.290000</td>
    </tr>
    <tr>
      <th id="T_ee254_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_ee254_row2_col0" class="data row2 col0" >1.430000</td>
      <td id="T_ee254_row2_col1" class="data row2 col1" >26.640000</td>
      <td id="T_ee254_row2_col2" class="data row2 col2" >32.020000</td>
      <td id="T_ee254_row2_col3" class="data row2 col3" >3713.470000</td>
      <td id="T_ee254_row2_col4" class="data row2 col4" >0.480000</td>
      <td id="T_ee254_row2_col5" class="data row2 col5" >1.140000</td>
      <td id="T_ee254_row2_col6" class="data row2 col6" >0.220000</td>
      <td id="T_ee254_row2_col7" class="data row2 col7" >0.360000</td>
      <td id="T_ee254_row2_col8" class="data row2 col8" >0.640000</td>
      <td id="T_ee254_row2_col9" class="data row2 col9" >0.360000</td>
    </tr>
  </tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">)[[</span><span class="s1">&#39;Risk&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#d65f5f&#39;</span><span class="p">,</span> <span class="s1">&#39;#5fba7d&#39;</span><span class="p">])</span>
</pre></div>
</div>
<style type="text/css">
#T_0f6f8_row0_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 14.0%, transparent 14.0%);
}
#T_0f6f8_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 45.6%, transparent 45.6%);
}
#T_0f6f8_row2_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 100.0%, transparent 100.0%);
}
</style>
<table id="T_0f6f8">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_0f6f8_level0_col0" class="col_heading level0 col0" >Risk</th>
    </tr>
    <tr>
      <th class="index_name level0" >rank</th>
      <th class="blank col0" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_0f6f8_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_0f6f8_row0_col0" class="data row0 col0" >8</td>
    </tr>
    <tr>
      <th id="T_0f6f8_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_0f6f8_row1_col0" class="data row1 col0" >26</td>
    </tr>
    <tr>
      <th id="T_0f6f8_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_0f6f8_row2_col0" class="data row2 col0" >57</td>
    </tr>
  </tbody>
</table>
<p>Our final model is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_final</span><span class="p">[[</span><span class="s1">&#39;score&#39;</span><span class="p">,</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span><span class="s1">&#39;shap_1&#39;</span><span class="p">,</span><span class="s1">&#39;shap_2&#39;</span><span class="p">,</span><span class="s1">&#39;shap_3&#39;</span><span class="p">,</span><span class="s1">&#39;shap_4&#39;</span><span class="p">,</span><span class="s1">&#39;shap_5&#39;</span><span class="p">,</span><span class="s1">&#39;shap_6&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shap_7&#39;</span><span class="p">,</span><span class="s1">&#39;shap_8&#39;</span><span class="p">,</span><span class="s1">&#39;shap_9&#39;</span><span class="p">,</span><span class="s1">&#39;shap_10&#39;</span><span class="p">,</span><span class="s1">&#39;shap_11&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>score</th>
      <th>rank</th>
      <th>shap_1</th>
      <th>shap_2</th>
      <th>shap_3</th>
      <th>shap_4</th>
      <th>shap_5</th>
      <th>shap_6</th>
      <th>shap_7</th>
      <th>shap_8</th>
      <th>shap_9</th>
      <th>shap_10</th>
      <th>shap_11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.344688</td>
      <td>2</td>
      <td>Little Check Account</td>
      <td>0</td>
      <td>0</td>
      <td>More Junior Client</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Less Credit Amount</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.296853</td>
      <td>1</td>
      <td>Little Check Account</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.410630</td>
      <td>2</td>
      <td>Little Check Account</td>
      <td>More Credit Duration</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Less Credit Amount</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.427560</td>
      <td>2</td>
      <td>Little Check Account</td>
      <td>0</td>
      <td>More Credit Amount</td>
      <td>More Junior Client</td>
      <td>Have House</td>
      <td>0</td>
      <td>0</td>
      <td>Less Credit Duration</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.184806</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>More Credit Amount</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Moderate/Rich Check Account</td>
      <td>0</td>
      <td>0</td>
      <td>More Senior Client</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>295</th>
      <td>0.187536</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>More Junior Client</td>
      <td>0</td>
      <td>0</td>
      <td>Moderate/Rich Check Account</td>
      <td>0</td>
      <td>Less Credit Amount</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>296</th>
      <td>0.245917</td>
      <td>1</td>
      <td>Little Check Account</td>
      <td>More Credit Duration</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>297</th>
      <td>0.167448</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>More Credit Amount</td>
      <td>More Junior Client</td>
      <td>0</td>
      <td>0</td>
      <td>Moderate/Rich Check Account</td>
      <td>Less Credit Duration</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>298</th>
      <td>0.658138</td>
      <td>2</td>
      <td>Little Check Account</td>
      <td>More Credit Duration</td>
      <td>More Credit Amount</td>
      <td>0</td>
      <td>Have House</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>299</th>
      <td>0.651962</td>
      <td>2</td>
      <td>Little Check Account</td>
      <td>0</td>
      <td>More Credit Amount</td>
      <td>More Junior Client</td>
      <td>Have House</td>
      <td>0</td>
      <td>0</td>
      <td>Less Credit Duration</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>300 rows × 13 columns</p>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./projects/2023-09-20-banking-risk-predict"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../2023-10-01-catboost-lgbm-xgboost/main.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Boosted Trees: XGBoost vs. CatBoost vs. LightGBM</p>
      </div>
    </a>
    <a class="right-next"
       href="../../cv.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">CV</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Credit Risk Prediction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#training-some-models">Training some Models</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperparameter-optimization-using-optuna">Hyperparameter Optimization using Optuna</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#ranking-the-final-model">Ranking the final model</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By João Pinheiro
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>